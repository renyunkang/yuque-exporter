
# è¯­é›€å¯¼å‡ºæ–‡æ¡£å·¥å…·
### åŠŸèƒ½ï¼š

- æ¨¡æ‹Ÿç”¨æˆ·æµè§ˆå™¨æ“ä½œä¸€ç¯‡ä¸€ç¯‡å¯¼å‡º markdown æ–‡æ¡£
- æŒ‰ç…§çŸ¥è¯†åº“ç›®å½•å¯¼å‡ºæ–‡æ¡£
- æ”¯æŒå¯¼å‡ºå¤±è´¥é‡è¯•
- å¯¼å‡ºæ–‡æ¡£ä¸­çš„å›¾ç‰‡åˆ°æœ¬åœ°
- æ›¿æ¢æ–‡æ¡£ä¸­çš„å›¾ç‰‡é“¾æ¥

> ps: åé¢ä¸¤ä¸ªåŠŸèƒ½æ˜¯ä½¿ç”¨ python å®ç°ï¼Œå¯ä»¥å•ç‹¬ä½¿ç”¨

æ•ˆæœå±•ç¤ºï¼š

![image.png](https://images.codingryken.eu.org/2023/05/91804cc3646d6356cd7458c9a12444fc.png)

![image.png](https://images.codingryken.eu.org/2023/05/4b3a4e4207ead71f15600806c12a5c1d.png)

åŠ¨å›¾å±•ç¤º(æ—§ç‰ˆå›¾ï¼Œæ–°ç‰ˆæœªæ›´æ–°å›¾)ï¼š![image.png](./images/exporter.gif)

### è¯´æ˜ï¼š

è¿™æ˜¯ä¸€ä¸ªåŸºäºpuppeteer æ¥æ¨¡æ‹Ÿç”¨æˆ·åœ¨æµè§ˆå™¨çš„æ“ä½œä¸€ç¯‡ä¸€ç¯‡çš„å¯¼å‡ºè¯­é›€æ–‡æ¡£çš„å·¥å…·ã€‚
å…³äºè¯­é›€çš„å¯¼å‡ºå¯ä»¥è¯¦æƒ…è¯´æ˜è§å®˜æ–¹çš„æ–‡æ¡£ï¼š[å¦‚ä½•å¯¼å…¥å¯¼å‡ºçŸ¥è¯†åº“](https://www.yuque.com/yuque/thyzgp/import-lake-to-lark) 

é¦–å…ˆè¯­é›€æ”¯æŒå¯¼å‡ºæ–‡æ¡£ä¸º markdown æ ¼å¼ã€‚
- å•ç¯‡å¯¼å‡ºï¼šæ”¯æŒå¯¼å‡ºä¸º markdownã€wordã€pdfã€lakebookç­‰
- æ‰¹é‡å¯¼å‡ºï¼šæ”¯æŒå¯¼å‡ºä¸º lakebookã€pdf æ ¼å¼ã€‚å¯¹äºè¶…çº§ç”¨æˆ·æ˜¯å¯ä»¥é€šè¿‡åˆ›å»º token æ¥ä½¿ç”¨[å®˜æ–¹çš„ exporter å·¥å…·](https://github.com/yuque/yuque-exporter)æˆ–è€…å…¶ä»–åŸºäº api çš„å·¥å…·è¿›è¡Œæ‰¹é‡å¯¼å‡ºï¼›è¶…çº§ç”¨æˆ·çš„ä»·æ ¼ä¸º 299/å¹´ã€‚

lakebook æ ¼å¼ä¸ºè¯­é›€ç§æœ‰çš„æ ¼å¼ï¼š[lakebook æ ¼å¼è¯´æ˜](https://www.yuque.com/yuque/developer/lt69uo)ï¼Œè¯­é›€ä¹Ÿæ²¡æœ‰ç›¸åº”çš„å·¥å…·å»æ”¯æŒè¿ç§»/å¯¼å…¥åˆ°å…¶ä»–ç¬”è®°è½¯ä»¶ã€‚pdf ä¼°è®¡ä¹Ÿä¸èƒ½ç›´æ¥å¯¼å…¥å…¶ä»–ç¬”è®°è½¯ä»¶(è¿™ä¸ªæ²¡æœ‰ç ”ç©¶è¿‡å°±ä¸å±•å¼€äº†)ã€‚

å› æ­¤å¯¹äºæƒ³è¦è¿ç§»è‡ªå·±æ–‡æ¡£çš„æ™®é€šç”¨æˆ·ä»¥åŠä¼šå‘˜ç”¨æˆ·æ¥è¯´ï¼Œä½ åªèƒ½ä¸€ç¯‡ä¸€ç¯‡å¯¼å‡ºæ¥å®Œæˆä½ çš„è¿ç§»åŠ¨ä½œï¼Œè¿™äº›ç”¨æˆ·ä¹Ÿå¤§å¤šæœ‰ä¸Šç™¾ç¯‡æ–‡æ¡£ï¼Œè¿™æ— ç–‘æ˜¯åŠé€€ã€‚æ‰€ä»¥æˆ‘çš„è¿ç§»è®¡åˆ’ä¹Ÿä¸€å†æç½®ï¼ŒåŒæ—¶ä¹Ÿå†ç­‰å¾…å…¶ä»–çš„æ›´å‹å¥½çš„å¯¼å‡ºæ–¹å¼å‡ºç°ã€‚æœ€åè¿˜æ˜¯ä¸æƒ³ç­‰äº†ï¼Œè¯·æ•™ GPT å†™äº†è¿™ä¸ªå·¥å…·ï¼Œç¡®å®ä¹Ÿæ€•åƒæˆ‘è¿™ç§ç™½å«–ç”¨æˆ·ä¹‹åçš„è¿ç§»çš„æˆæœ¬è¶Šæ¥è¶Šå¤§äº†ã€‚

> ps: æœ¬äººä¹Ÿä¸æ˜¯ä¸“é—¨å†™ nodejs çš„ï¼Œä»£ç å¯èƒ½ä¹Ÿæ˜¯çƒ‚æˆç‹—å±ï¼Œè¯·å¤§å®¶ä¸å–œå‹¿å–·ã€‚è°¢è°¢ï¼

### ä½¿ç”¨ï¼š
> ç¡®ä¿ä½ çš„ç¯å¢ƒæœ‰ Chromium æµè§ˆå™¨ã€‚å¦‚ Google Chromeã€Microsoft Edgeã€Opera å’Œ Braveç­‰ï¼Œéƒ½æ˜¯åŸºäº Chromium æµè§ˆå™¨æ„å»ºçš„ã€‚

#### 1. å®‰è£… node ç›¸å…³çš„å·¥å…·
å»ºè®®ä½¿ç”¨ nvm ç®¡ç† nodeï¼Œé€‰å–ä¸‹åˆ—é€‚åˆè‡ªå·±çš„æ–¹å¼å®‰è£…ï¼š
- github åœ°å€ï¼š[nvm-sh/nvm: Node Version Manager](https://github.com/nvm-sh/nvm)
- gitee åœ°å€ï¼š[nvm-cn: ğŸ§Š nvmå›½å†…å®‰è£…å·¥å…· (gitee.com)](https://gitee.com/RubyKids/nvm-cn)

é…ç½® npm æ·˜å®æºï¼šnpm config set registry https://registry.npmmirror.com

å®‰è£… yarnï¼šnpm install -g yarn --registry=https://registry.npmmirror.com

#### 2. ä¸‹è½½ä»£ç å¹¶å¯¼å‡º
**ä¸‹è½½ä»£ç å¹¶å®‰è£…ä¾èµ–**
```bash
git clone https://github.com/renyunkang/yuque-exporter.git
cd yuque-exporter
npm install --registry=https://registry.npm.taobao.org
# å®‰è£… JSONStreamï¼š
# npm install JSONStream --registry=https://registry.npm.taobao.org

# yarn å®‰è£…ä¾èµ–å¦‚æœä¸‹è½½æŠ¥é”™çš„è¯ï¼Œå¯ä»¥ä¾æ®æƒ…å†µæ›´æ¢æºã€‚
yarn
```

**è®¾ç½®ç¯å¢ƒå˜é‡å¹¶ä½¿ç”¨å·¥å…·å¯¼å‡º**

éœ€è¦ç”¨åˆ°çš„ç¯å¢ƒå˜é‡ï¼š

| ç¯å¢ƒå˜é‡ | é€‰é¡¹ | æè¿° |
|--|--|--|
| USER | å¿…é¡»(æœ‰cookieæ–‡ä»¶æ—¶éå¿…é¡») | ç™»å½•çš„ç”¨æˆ·å |
| PASSWORD | å¿…é¡»(æœ‰cookieæ–‡ä»¶æ—¶éå¿…é¡») | ç™»å½•çš„å¯†ç  |
| EXPORT_PATH | éå¿…é¡» | æŒ‡å®šå¯¼å‡ºè·¯å¾„ï¼Œé»˜è®¤ä¸ºå½“å‰å·¥ä½œç›®å½•ä¸‹çš„ output ç›®å½•(è‡ªåŠ¨åˆ›å»º) |


- **ubuntu**
```bash
# ç¬¬ä¸€æ¬¡è¿è¡Œæ—¶ï¼Œä½¿ç”¨ USER + PASSWORD ç™»å½•
# USER=xxx PASSWORD=xxx node main.js
USER=xxx PASSWORD=xxx EXPORT_PATH=/path/to/exporter node main.js

# ç™»å½•ä¸€æ¬¡åä¼šä¿å­˜ cookieï¼Œä¹‹åä½¿ç”¨cookieç™»å½•
# node main.js
EXPORT_PATH=/path/to/exporter node main.js
```

- **windows**
```bash
# 1. cmd
set USER="xxx"
set PASSWORD="xxx"
# set EXPORT_PATH=/path/to/exporter
node main.js

# 2. powershell
# $env:USER="xxx";$env:PASSWORD="xxx"; node .\main.js
$env:USER="xxx";$env:PASSWORD="xxx";$env:EXPORT_PATH="/path/to/exporter"; node .\main.js
```

- **MacOS**
```bash
# å¯†ç æœ‰ç‰¹æ®Šå­—ç¬¦ï¼Œå»ºè®®å•å¼•å·å¤„ç†
export USER='xxx'
export PASSWORD='xxx'

# è¿è¡Œ
node main.js
```

#### 3. å¯¼å‡ºæ–‡æ¡£ä¸­çš„å›¾ç‰‡

éœ€è¦ç”¨åˆ°çš„å‡ ä¸ªç¯å¢ƒå˜é‡ï¼š

| ç¯å¢ƒå˜é‡ | é€‰é¡¹ | æè¿° |
|--|--|--|
| MARKDOWN_DIR | éå¿…é¡» | æŒ‡å®š mardown æ–‡ä»¶å¤¹è·¯å¾„ï¼Œé»˜è®¤ä¸ºå½“å‰å·¥ä½œç›®å½•çš„ output ç›®å½• |
| DOWNLOAD_IMAGE | éå¿…é¡» | æŒ‡å®šæ˜¯å¦å¯¼å‡ºå›¾ç‰‡ï¼Œå¯¼å‡ºè·¯å¾„ä¸º MARKDOWN_DIR ç›®å½•ä¸‹çš„ images ç›®å½•ï¼Œé»˜è®¤ä¸º true |
| UPDATE_MDIMG_URL | éå¿…é¡» | æŒ‡å®šæ˜¯å¦æ›´æ–°æ–‡ä»¶ä¸­çš„å›¾ç‰‡è·¯å¾„ï¼ŒæœªæŒ‡å®š REPLACE_IMAGE_HOST æ—¶ï¼Œä¼šæ›´æ–°ä¸ºå›¾ç‰‡è·¯å¾„çš„ç›¸å¯¹è·¯å¾„ã€‚é»˜è®¤ä¸º false |
| REPLACE_IMAGE_HOST | éå¿…é¡» | æ›´æ–°å›¾ç‰‡è·¯å¾„æ—¶è‡ªå®šä¹‰æ–‡ä»¶ urlï¼Œæ ¼å¼ä¸ºï¼š{REPLACE_IMAGE_HOST}/{years}/{img_name}ï¼Œåœ¨ä½¿ç”¨è‡ªå®šä¹‰å¯¹è±¡å­˜å‚¨æ—¶ï¼Œå»ºè®®ä¸Šä¼ å›¾ç‰‡æ—¶çš„è·¯å¾„ç¬¦åˆå‰é¢çš„æ ¼å¼ï¼›é»˜è®¤ä¸ºç©º |

**ä½¿ç”¨å·¥å…·å¯¼å‡º**

```bash
# ä»¥ windows powershell ä¸ºä¾‹
# ä¸‹è½½å›¾ç‰‡ï¼Œä¸æ›´æ–° mardown æºæ–‡ä»¶çš„å›¾ç‰‡é“¾æ¥
python.exe .\export-image.py

# ä¸ä¸‹è½½å›¾ç‰‡ï¼Œæ›´æ–°æ–‡ä»¶çš„å›¾ç‰‡ä¸ºç›¸å¯¹è·¯å¾„
$env:DOWNLOAD_IMAGE="false";$env:UPDATE_MDIMG_URL="true"; python.exe .\export-image.py

# ä¸ä¸‹è½½å›¾ç‰‡ï¼Œæ›´æ–°æ–‡ä»¶çš„å›¾ç‰‡ä¸ºè‡ªå®šä¹‰å¯¹è±¡å­˜å‚¨(è‡ªå®šä¹‰åŸŸå)
$env:DOWNLOAD_IMAGE="false";$env:UPDATE_MDIMG_URL="true"; $env:REPLACE_IMAGE_HOST="https://images.ryken.cloud/"; python.exe .\export-image.py
```

> ps: 
> 1. å½“ä½¿ç”¨ python è¿è¡Œæ—¶ï¼Œå¦‚æœæ²¡æœ‰ç›¸å…³ä¾èµ–çš„è¯ï¼Œéœ€è¦æ‰‹åŠ¨ä¸‹è½½ä¸€ä¸‹; pip install xxx
> 2. ç›¸å…³ç¯å¢ƒå˜é‡çš„æ˜¯æŒ‡åŒä¸Šé¢"ä¸‹è½½ä»£ç å¹¶å¯¼å‡º"
> 3. æ ¹æ®è‡ªå·±éœ€è¦ï¼ŒæŒ‡å®šä¸åŒç¯å¢ƒå˜é‡çš„å€¼ï¼Œæ¥æ»¡è¶³ä¸åŒçš„éœ€æ±‚å§



### å­˜åœ¨çš„é—®é¢˜ï¼š
1.è‡ªåŠ¨ç™»å½•ä»…æ”¯æŒè´¦å·å¯†ç ç™»å½•

2.æ— æ³•ä¿è¯å…¼å®¹æ€§ï¼Œå¦‚æœä¹‹åå®˜æ–¹ api ä¿®æ”¹åï¼Œå¯ä»¥è‡ªå·±æ ¹æ® api ä¿®æ”¹æºç 

3.æ— æ³•å¯¼å‡ºå†…å®¹ä¸ºçº¯è¡¨æ ¼/æ€ç»´å¯¼å‡ºçš„æ–‡æ¡£(å®˜æ–¹ä¹Ÿä¸æ”¯æŒå°†å…¶ç›´æ¥å¯¼å‡ºä¸º markdown)ï¼›å› æ­¤æŠ¥é”™çš„ timeoutï¼Œå¯èƒ½ä¸ºè¿™äº›ç±»å‹çš„æ–‡æ¡£ï¼Œè¯·é‡å¤ç¡®è®¤åæ‰‹åŠ¨å¯¼å‡ºä¸ºå…¶ä»–æ ¼å¼ã€‚

4.å›¢é˜Ÿçš„å¯¼å‡ºæœªæµ‹è¯•

### Q&A
1.  Could not find Chromium ä½†æ˜¯æœ‰ chorm æµè§ˆå™¨
åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸Šï¼ŒPuppeteer é»˜è®¤è°ƒç”¨çš„ Chrome è·¯å¾„å¦‚ä¸‹ï¼š
-   Windows:Â C:\Program Files (x86)\Google\Chrome\Application\chrome.exe
-   macOS:Â /Applications/Google Chrome.app/Contents/MacOS/Google Chrome
-   Linux:Â /usr/bin/google-chrome
å¦‚æœä¸»æœºä¸Šå¯¹åº”çš„å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„ä¸é»˜è®¤ä¸€è‡´ä½†ä»ç„¶è¿è¡Œå¤±è´¥ï¼Œå¯ä»¥ä¿®æ”¹æºç æ‰‹åŠ¨æŒ‡å®šä¸€ä¸‹ï¼Œå¦‚æœæ²¡æœ‰chormeä¹Ÿå¯ä»¥æ‰§è¡Œedgeçš„äºŒè¿›åˆ¶æ–‡ä»¶
![image.png](https://images.codingryken.eu.org/2023/05/eb093fe57cb0b6cc557a9616f5899445.png)
```js
const browser = await puppeteer.launch({ headless: true });
 to
const browser = await puppeteer.launch({ headless: true, executablePath: '/usr/bin/google-chrome' });
 or
// headless: false ä¼šæ‰“å¼€æµè§ˆå™¨å®æ—¶è§‚å¯Ÿæ¨¡æ‹Ÿçš„æ“ä½œï¼Œå¯ç”¨äºè°ƒè¯•ï¼›executablePath æ›¿æ¢ä¸ºè‡ªå·±æœ¬æœºå¯¹åº”è·¯å¾„
const browser = await puppeteer.launch({ headless: false, executablePath: "C:\\Program Files (x86)\\Microsoft\\Edge\\Application\\msedge.exe" });
```

